# 🎯 远程攻击设置指南

## ✅ 已完成的修改

代码已经支持远程攻击模式：
- ✅ 添加了 `isRanged` 属性到 `AttackMover` 组件
- ✅ 远程攻击时只播放攻击动画，不移动
- ✅ 攻击动画完成后释放技能（如火球术）
- ✅ 目标会播放受击动画

## 🎮 设置步骤

### 第1步：为法师添加 AttackMover 组件（如果还没有）

1. 打开 `assets/Prefabs/法师.prefab`
2. 选择根节点
3. 添加 `AttackMover` 组件（如果还没有的话）

### 第2步：设置远程攻击属性

在 `AttackMover` 组件的属性面板中：

1. **勾选 `Is Ranged`** ✅
   - 这个选项让法师在原位置攻击，不移动到目标位置

2. 其他属性保持默认或根据需要调整：
   - `Move Speed`: 不影响远程攻击（因为不移动）
   - `Attack Distance`: 不影响远程攻击
   - `Attack Duration`: 攻击动画时长（建议 0.3-0.5秒）
   - `Use Spine Animation`: 是否使用Spine动画（建议勾选）

### 第3步：保存并测试

1. 保存预制体
2. 运行游戏
3. 法师应该：
   - ✅ 在原位置播放攻击动画
   - ✅ 不移动到目标位置
   - ✅ 攻击动画完成后释放火球术
   - ✅ 火球飞向目标

## 📋 效果对比

### 近战角色（如战士）
```
战士 (原位置)
  ↓ [移动到目标]
战士 → 巨狼 (靠近目标)
  ↓ [攻击动画]
战士 ⚔️ 巨狼
  ↓ [返回原位置]
战士 (原位置)
  ↓ [执行伤害]
```

### 远程角色（如法师）
```
法师 (原位置)
  ↓ [播放攻击动画，不移动]
法师 🎯 (原位置，播放攻击动画)
  ↓ [释放技能]
🔥 火球飞向目标
  ↓ [执行伤害]
```

## 🔧 工作原理

### 代码逻辑

1. **ActionSystem** 检测到 `AttackMover` 组件
2. 调用 `attackTarget()` 方法
3. `attackTarget()` 检查 `isRanged` 属性：
   - 如果 `isRanged = true` → 调用 `playAttackAnimationOnly()`（只播放动画）
   - 如果 `isRanged = false` → 调用 `_performAttackSequence()`（移动+攻击+返回）
4. 动画完成后执行技能效果

### 关键代码

```javascript
// AttackMover.js
if (this.isRanged) {
    this.playAttackAnimationOnly(target, onComplete);
    return;
}
// 否则执行正常的移动+攻击序列
```

## 🎨 动画说明

### 远程攻击动画流程

1. **播放攻击动画**：
   - 如果使用Spine动画：播放 `atk` 动画
   - 如果不使用Spine：播放缩放动画

2. **播放目标受击动画**：
   - 目标播放 `byatk` 受击动画
   - 受击动画完成后返回待机状态

3. **释放技能**：
   - 攻击动画完成后，执行技能效果
   - 火球术特效开始播放

## ⚙️ 配置建议

### 法师（远程攻击）

```
AttackMover 组件设置：
✅ Is Ranged: true          // 关键设置！
✅ Use Spine Animation: true
Attack Duration: 0.3       // 攻击动画时长
Hit Animation Delay: 0.15   // 受击动画延迟（让战斗更流畅）
Move Speed: 500            // 不影响（不移动）
Attack Distance: 50        // 不影响（不移动）
```

### 战士（近战攻击）

```
AttackMover 组件设置：
❌ Is Ranged: false        // 近战需要移动
✅ Use Spine Animation: true
Attack Duration: 0.3
Hit Animation Delay: 0.15   // 受击动画延迟（让战斗更流畅）
Move Speed: 500            // 移动速度
Attack Distance: 50        // 攻击距离
```

### 受击动画延迟说明

**`Hit Animation Delay`** 属性用于控制受击动画的延迟播放时间：
- **默认值**: 0.15秒
- **推荐范围**: 0.1 - 0.3秒
- **作用**: 让受击动画在攻击动画之后延迟播放，使战斗看起来更流畅自然
- **效果**: 
  - 攻击者先播放攻击动画
  - 延迟0.15秒后，目标播放受击动画
  - 避免了两个动画同时播放造成的卡顿感

## 🐛 常见问题

### 问题1：法师还是移动了

**原因**：`Is Ranged` 属性没有勾选

**解决方案**：
1. 打开 `法师.prefab`
2. 选择根节点
3. 在 `AttackMover` 组件中勾选 `Is Ranged`
4. 保存预制体
5. 重新运行游戏

### 问题2：攻击动画不播放

**原因**：
- Spine组件未找到
- `Use Spine Animation` 被取消勾选但节点没有Spine组件

**解决方案**：
1. 确认节点有 `sp.Skeleton` 组件
2. 确认 `Use Spine Animation` 设置正确
3. 检查Spine动画资源是否正确

### 问题3：技能在动画前就释放了

**原因**：`AttackMover` 组件未添加或未启用

**解决方案**：
1. 确认 `AttackMover` 组件已添加到节点
2. 确认组件已启用（`enabled = true`）

### 问题4：目标没有播放受击动画

**原因**：目标节点没有Spine组件或动画资源

**解决方案**：
1. 确认目标节点有 `sp.Skeleton` 组件
2. 确认目标有 `byatk` 受击动画
3. 检查动画资源是否正确

## 📝 检查清单

在设置远程攻击前，确认：

- [ ] `AttackMover` 组件已添加到法师节点
- [ ] `Is Ranged` 属性已勾选 ✅
- [ ] `Use Spine Animation` 设置正确
- [ ] 法师节点有 `sp.Skeleton` 组件
- [ ] 法师有 `atk` 攻击动画
- [ ] 目标节点有 `sp.Skeleton` 组件（用于受击动画）
- [ ] 目标有 `byatk` 受击动画
- [ ] `SkillEffectPlayer` 组件已设置（用于火球术特效）

## 🎯 测试步骤

1. **运行游戏**
2. **观察法师攻击**：
   - ✅ 法师在原位置播放攻击动画
   - ✅ 法师不移动到目标位置
   - ✅ 目标播放受击动画
   - ✅ 攻击动画完成后，火球从法师位置飞向目标
   - ✅ 火球到达目标后爆炸

3. **对比近战角色**：
   - 战士应该移动到目标位置
   - 法师应该留在原位置

## 🚀 下一步优化建议

1. **添加施法特效**：在法师播放攻击动画时添加魔法阵或光效
2. **添加音效**：攻击动画和技能释放时播放音效
3. **添加屏幕震动**：火球爆炸时轻微震动
4. **添加技能指示器**：显示技能释放范围或目标

祝你游戏开发顺利！🎉

