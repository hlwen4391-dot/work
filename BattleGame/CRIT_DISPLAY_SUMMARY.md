# æš´å‡»é£˜å­—æ•ˆæœ - å®ç°æ€»ç»“

## ğŸ“ éœ€æ±‚

ä¸ºæˆ˜æ–—ç³»ç»Ÿæ·»åŠ æš´å‡»å˜è‰²é£˜å­—æ•ˆæœï¼Œè®©æš´å‡»æ›´æœ‰è§†è§‰å†²å‡»åŠ›ã€‚

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. HealthBar.js - é£˜å­—æ ¸å¿ƒé€»è¾‘

**ä¿®æ”¹å†…å®¹**:
- `showDamage(value, type)` æ–¹æ³•æ”¯æŒç±»å‹å‚æ•°
- å®ç° 4 ç§ä¼¤å®³ç±»å‹ï¼š`crit`, `normal`, `miss`, `heal`
- æ·»åŠ  `_playFloatAnimation()` æ–¹æ³•å¤„ç†ä¸åŒåŠ¨ç”»
- æš´å‡»ç‰¹æ•ˆï¼šéœ‡åŠ¨ + æ©™çº¢è‰² + 1.5å€å¤§å° + é£˜é«˜50px
- æ·»åŠ  `_resetLabel()` æ–¹æ³•é‡ç½®çŠ¶æ€

### 2. StatsComponent.js - å±æ€§ç»„ä»¶æ¥å£

**ä¿®æ”¹å†…å®¹**:
- `updateHealthBar(damage, type)` æ·»åŠ  `type` å‚æ•°
- æ”¯æŒä¼ é€’ä¼¤å®³ç±»å‹åˆ° HealthBar
- é—ªé¿æ—¶æ˜¾ç¤º "MISS!" æ–‡å­—

### 3. CombatSystem.js - æˆ˜æ–—ç³»ç»Ÿ

**ä¿®æ”¹å†…å®¹**:
- `damage()` æ–¹æ³•æ£€æµ‹æš´å‡»å¹¶ä¼ é€’ `'crit'` ç±»å‹
- é—ªé¿æ—¶ä¼ é€’ `'miss'` ç±»å‹
- `damageTrue()` çœŸä¼¤ä¼ é€’ `'normal'` ç±»å‹
- æ·»åŠ  `isCrit` æ ‡è®°åˆ¤æ–­æ˜¯å¦æš´å‡»

### 4. BuffRegistry.js - Buffç³»ç»Ÿ

**ä¿®æ”¹å†…å®¹**:
- ç‡ƒçƒ§ buff ä¼¤å®³æ˜¾ç¤ºä¸º `'normal'` ç±»å‹

## ğŸ¨ æ•ˆæœç±»å‹

| ç±»å‹ | é¢œè‰² | å¤§å° | é£˜é«˜ | æ—¶é•¿ | éœ‡åŠ¨ | è§¦å‘æ¡ä»¶ |
|------|------|------|------|------|------|---------|
| `crit` | æ©™çº¢è‰² | 1.5x | 50px | 1.2s | âœ… | æš´å‡»æˆåŠŸ |
| `normal` | ç™½è‰² | 1.0x | 30px | 1.0s | âŒ | æ™®é€šä¼¤å®³ |
| `miss` | ç°è‰² | 1.0x | 20px | 1.0s | âŒ | é—ªé¿æˆåŠŸ |
| `heal` | ç»¿è‰² | 1.2x | 40px | 1.0s | âŒ | æ²»ç–—æ•ˆæœ |

## ğŸ”„ æ•°æ®æµ

```
æ”»å‡»è€…æ”»å‡»
    â†“
CombatSystem.damage()
    â†“
[æ£€æµ‹é—ªé¿] â†’ tgtStats.updateHealthBar(0, 'miss')
    â†“
[æ£€æµ‹æš´å‡»] â†’ isCrit = true
    â†“
[è®¡ç®—ä¼¤å®³]
    â†“
tgtStats.updateHealthBar(finalDamage, isCrit ? 'crit' : 'normal')
    â†“
StatsComponent.updateHealthBar(damage, type)
    â†“
healthBar.showDamage(damage, type)
    â†“
HealthBar æ ¹æ® type è®¾ç½®é¢œè‰²/å¤§å°/åŠ¨ç”»
    â†“
æ’­æ”¾é£˜å­—åŠ¨ç”»
```

## ğŸ® ä½¿ç”¨æ–¹å¼

### è‡ªåŠ¨å·¥ä½œï¼ˆæ— éœ€é…ç½®ï¼‰

æ‰€æœ‰æˆ˜æ–—ä¼¤å®³éƒ½ä¼šè‡ªåŠ¨æ˜¾ç¤ºå¯¹åº”ç±»å‹çš„é£˜å­—æ•ˆæœã€‚

### æ‰‹åŠ¨è°ƒç”¨ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰

```javascript
// æ˜¾ç¤ºæš´å‡»
stats.updateHealthBar(damage, 'crit');

// æ˜¾ç¤ºé—ªé¿
stats.updateHealthBar(0, 'miss');

// æ˜¾ç¤ºæ²»ç–—
stats.updateHealthBar(healAmount, 'heal');
```

## ğŸ“Š å…³é”®ä»£ç ç‰‡æ®µ

### æš´å‡»æ£€æµ‹ (CombatSystem.js)

```javascript
let isCrit = false;
const critChance = atkStats.crit || 0;
if (Math.random() < critChance) {
    finalDamage *= 2;
    isCrit = true;
}

// ä¼ é€’æš´å‡»ç±»å‹
tgtStats.updateHealthBar(finalDamage, isCrit ? 'crit' : 'normal');
```

### æš´å‡»ç‰¹æ•ˆ (HealthBar.js)

```javascript
case 'crit':
    this.damageLabel.node.color = cc.color(255, 69, 0);  // æ©™çº¢è‰²
    this.damageLabel.node.scale = 1.5;  // 1.5å€
    this._playFloatAnimation(startY, startScale, 50, 1.2, true);  // éœ‡åŠ¨
    break;
```

### éœ‡åŠ¨åŠ¨ç”» (HealthBar.js)

```javascript
if (shake) {
    tween
        .to(0.1, { scale: startScale * 1.2 }, { easing: 'backOut' })  // æ”¾å¤§
        .to(0.1, { scale: startScale })  // æ¢å¤
        .parallel(
            cc.tween().to(duration, { y: startY + floatHeight }),  // é£˜é«˜
            cc.tween().to(duration, { opacity: 0 })  // æ·¡å‡º
        )
        .start();
}
```

## ğŸ¯ æŠ€æœ¯ç‰¹ç‚¹

1. **ç±»å‹åŒ–è®¾è®¡**: ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹åŒºåˆ†ä¸åŒä¼¤å®³
2. **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„ä¼¤å®³ç±»å‹
3. **å‘åå…¼å®¹**: é»˜è®¤å‚æ•°ç¡®ä¿æ—§ä»£ç ä»èƒ½å·¥ä½œ
4. **åŠ¨ç”»å¤ç”¨**: `_playFloatAnimation` ç»Ÿä¸€å¤„ç†åŠ¨ç”»é€»è¾‘
5. **çŠ¶æ€é‡ç½®**: `_resetLabel` ç¡®ä¿åŠ¨ç”»ç»“æŸåçŠ¶æ€æ­£ç¡®

## ğŸ› æµ‹è¯•è¦ç‚¹

- [x] æš´å‡»æ—¶æ˜¾ç¤ºæ©™çº¢è‰²å¤§å­—
- [x] æ™®é€šä¼¤å®³æ˜¾ç¤ºç™½è‰²é£˜å­—
- [x] é—ªé¿æ—¶æ˜¾ç¤ºç°è‰² "MISS!"
- [x] åŠ¨ç”»æµç•…ä¸å¡é¡¿
- [x] å¤šä¸ªé£˜å­—ä¸å†²çª
- [x] é£˜å­—ç»“æŸåæ­£ç¡®é‡ç½®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `CRIT_DAMAGE_DISPLAY.md` - è¯¦ç»†åŠŸèƒ½æ–‡æ¡£
- `CRIT_DISPLAY_QUICK.md` - å¿«é€Ÿä½¿ç”¨æŒ‡å—

## ğŸš€ åç»­æ‰©å±•å»ºè®®

1. **éŸ³æ•ˆ**: æš´å‡»æ—¶æ’­æ”¾ç‰¹æ®ŠéŸ³æ•ˆ
2. **ç²’å­**: æš´å‡»æ—¶ç”Ÿæˆç²’å­ç‰¹æ•ˆ
3. **è¿å‡»**: è¿ç»­æš´å‡»æ—¶æ˜¾ç¤ºè¿å‡»æ•°
4. **å¯¹è±¡æ± **: ä¼˜åŒ–é£˜å­—æ€§èƒ½
5. **å…ƒç´ ä¼¤å®³**: ç«ã€å†°ã€é›·ç­‰ä¸åŒé¢œè‰²

## ğŸ‰ æ€»ç»“

æˆåŠŸä¸ºæˆ˜æ–—ç³»ç»Ÿæ·»åŠ äº†å®Œæ•´çš„æš´å‡»é£˜å­—æ•ˆæœï¼š
- âœ… 4ç§ä¼¤å®³ç±»å‹æ”¯æŒ
- âœ… ç‚«é…·çš„éœ‡åŠ¨åŠ¨ç”»
- âœ… æ¸…æ™°çš„è§†è§‰åé¦ˆ
- âœ… æ˜“äºæ‰©å±•çš„æ¶æ„

ç°åœ¨æ¸¸æˆçš„æˆ˜æ–—ä½“éªŒæ›´åŠ ç”ŸåŠ¨å’Œåˆºæ¿€äº†ï¼ğŸ’¥

